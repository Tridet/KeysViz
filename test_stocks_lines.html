
fresh block
byTridetview bl.ock
logout
NewForkSave
 
➕

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
        .line {
      fill: none;
      stroke: black;
      stroke-width: 1.5px;
    }
    .line {
    fill: none;
    stroke: #ffab00;
    stroke-width: 1.5;
}
  </style>
</head>
  <!--
  <svg width=600 height=600>
    <rect style="x:100;y:150;width:50;height:100;"></rect>
    <rect style="x:200;y:50;width:50;height:200;"></rect>
    <rect style="x:300;y:170;width:50;height:80;"></rect>
​
  </svg>
  -->
​
<body>
  <script>
    
    //1. Créer le SVG
    var svg = d3.select("body")
    .append("svg")
    .attr("width",1200)
    .attr("height",600)
    
    //2. Générer les données
//     var data=d3.range(100);
    var long=800,larg=350,offset_up=400;
    // Aesthetic
    var color = d3.scaleOrdinal(d3.schemeCategory10);
    
    var symbolos = d3.scaleOrdinal(d3.symbols);
    var symbol = d3.symbol().size(70);  
    
    parseDate = d3.timeParse("%b %Y");
    // console.log(parseDate("Jan 2000"));
    
    d3.csv('stocks.csv').then(function(data){
     data.forEach(function(d) {
     d.symbol = d.symbol;
     d["date"] = parseDate(d["date"]);
     d.price = +d.price;
     });
      
      var symbols = d3.nest()
      .key(function(d) { return d.symbol; })
      .entries(data);
      
      symbols.forEach(function(s) {
      s.values.forEach(function(d) { 
//         d["date"] = parseDate(d["date"]); 
//         d.price = +d.price;
      });
      
      s.maxPrice = d3.max(s.values, function(d) { return d.price; });
      s.sumPrice = d3.sum(s.values, function(d) { return d.price; });
      
    });
    //3. Data binding
    
    //scaleLinear
    var y = d3.scaleLinear()
    .range([0,larg]) //px
    
    //scaleBand
    var x = d3.scaleTime()
    .domain(d3.range(data.length))
    .range([200,long])
    
//     svg.selectAll("rect").data(data).enter()
//       .append("rect")
//       .attr("x",function(d,i){return x(d);})
//       .attr("y",function(d,i){return 300-y(d);})
//       .attr("width", function(d,i){return x.bandwidth();})
//       .attr("height",function(d,i){return y(d);})
//       .attr("fill",function(d,i){return color(i)})
    
//       .on("mouseover", function(d,i){
//          d3.select(this)
//         .attr("fill","blue")
         
//         svg.append("text").text(d)
//         .attr("id","label") //manière simple d'identifier un élément
//         .attr("x",x(d))
//         .attr("y",300-y(d))
//         })
    
//       .on("mouseleave", function(d,i){
//         d3.select(this)
//          .attr("fill",color(i))
        
//         d3.select("#label").remove()});
    
      x.domain(d3.extent(data,function(d){return d["date"];}))
      y.domain(d3.extent(data,function(d){return d.price;}))
    
​
      var xAxis = d3.axisBottom()
       .scale(x);
​
      svg.append('g')
        .attr('transform', 'translate(0,' + offset_up + ')')
        .attr('class', 'x axis')
        .call(xAxis);
     
      var y2 = d3.scaleLinear()
      .range([larg,0]) //px
      y2.domain(d3.extent(data,function(d){return d.price;}))
​
      var yAxis = d3.axisLeft()
      .scale(y2);
​
      svg.append('g')
        .attr('transform', 'translate(200,' + 50 + ')')
        .attr('class', 'y axis')
        .call(yAxis);
      
      var line = d3.line().curve(d3.curveMonotoneX)
      .x(function(d) { return x(d["date"]); })
      .y(function(d) { return offset_up-y(d.price); });
      
      svg.selectAll(".line").data(symbols).enter()
        .append("path")
        .attr("class", "line")
        .attr("d", function(d) { return line(d.values); })
        .attr("id", function(d) { return d.symbol; })
        .style("stroke", function(d){return color(d.key)});
      
      svg.selectAll("path2").data(data).enter()
        .append("path")
        .attr("class", "symbol")
        .attr("d", function(d,i) { return symbol.type(symbolos(d.symbol))(); })
        .attr("id", function(d) { return d.symbol; })
        .attr("transform", function(d) { 
        return "translate(" + x(d["date"]) + "," + y(260-d.price) +")"; 
      })
        .style("fill", function(d){return color(d.symbol)})
        .on("mouseover", function(d,i){
        d3.select(this)
          .style("fill","black")
          .attr("font-size",100)
​
        svg.append("text").text(d.price)
          .attr("id","label") //manière simple d'identifier un élément
          .attr("x",x(d["date"])-50)
          .attr("y",400-y(d.price))
      })
​
        .on("mouseleave", function(d,i){
        d3.select(this)
          .style("fill",color(d.symbol))
​
        d3.select("#label").remove()});
​
​
    
​
    
    })
    
  </script>
</body>
